{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "colab": {
     "base_uri": "https://localhost:8080/"
    },
    "id": "iAtJDSIsTxAN",
    "outputId": "4e996c87-3120-493e-e65c-a6e7d95d22fb"
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Silhouette Score for K-means clustering: 0.025271760806722412\n",
      "\n",
      "Topic 0:\n",
      " - Amazon is clearing its stock: Seize the best-selling AirPods Pro 2 at a massive discount before they vanish\n",
      " - Apple iPhone 16 Pro Max review: A towering success\n",
      " - iOS and Android Security Scare: Two Apps Found Supporting 'Pig Butchering' Scheme\n",
      " - How the iPhone 16 Camera Control Button Changes How You Take iPhone Photos\n",
      " - Apple Intelligence will drive iPhone 16 sales but isn't a major factor yet\n",
      " - Apple severely cuts Vision Pro production, and may stop it completely very soon\n",
      " - M4 MacBook Pro production appears well underway, as launch expected soon\n",
      " - Month-end iPad sale: $298 10th Gen, M4 iPad Pro $899, iPad mini 7 deals\n",
      " - Apple projector could display AR and VR content without a headset\n",
      " - Nearly every teenager still has an iPhone, and most have AirPods too\n",
      " - Apples Have Never Tasted So Delicious. Here’s Why\n",
      " - Designers reimagine iPod Touch in iPhone 16 design language\n",
      "\n",
      "Topic 1:\n",
      " - Best Prime Day Monitor Deals: Save Big on Displays From LG, Samsung, Apple and More\n",
      " - Best Prime Day Monitor Deals: Save on Displays From LG, Samsung, Apple and More\n",
      " - Prime Day Laptop Deals: Huge Apple, Acer, and Samsung Discounts Available Now\n",
      " - Best Prime Day Tablet Deals: Score Massive Savings on Apple, Amazon, Samsung and More\n",
      " - Best Prime Day Laptop Deals: Save Now on MacBooks, Chromebooks and More\n",
      " - Deals: Apple Pencil Pro all-time low, new Apple Watch SE 2 configs from $189, iPad Air, MagSafe gear, more\n",
      " - Deals: Jet Black Apple Watch Series 10 $376, black Milanese Loop all-time low, Mac keyboards 30% off, more\n",
      " - Best Prime Day Apple Deals: Save on MacBooks, iPads, Apple Watches and More\n",
      " - Deals: 46mm silver Apple Watch Series 10 all-time low, Apple Watch Ultra 2 $99 off, M2 MacBook Air $399 off, more\n",
      " - Deals: M3 Pro MacBook Pro $500 off, M4 iPad Pro new low, black Magic Keyboard, Camera Control cases, more\n",
      " - Best Prime Day Monitor Deals: Save on Displays From LG, Samsung, Apple and More\n",
      " - Deals: M3 MacBook Air $249 off, M2 $399 off, 42mm Apple Watch Series 10 at new $370 low, leather bands, more\n",
      " - Best Prime Day Laptop Deals: Big Discounts on Apple, Samsung, HP and More\n",
      " - Best Prime Day Laptop Deals: Save Big on Apple, Samsung, HP and More\n",
      " - Deals: 46mm Jet Black Apple Watch Series 10 $399 + gold models, first leather iPhone 16 Camera Control case, more\n",
      "\n",
      "Topic 2:\n",
      " - If You’ve Already Bought AirPods Pro 2, This Insane Prime Day Price Will Make You Jealous\n",
      " - Amazon Slashes AirPods Max Price to Record Low for Prime Day Clearance Sale\n",
      " - It Isn’t Free, But The MacBook Air is Available at Ridiculous Prices For Prime Day\n",
      " - Amazon Crushes iPad Prices by 40%, Hitting Apple Hard on Day Two of Prime Day\n",
      " - Apple's 9th-gen iPad returns to an all-time low of $199 for October Prime Day\n",
      " - 2024 MacBook Air Heavily Discounted on Prime Day: How Could Apple Allow Amazon to Do This?\n",
      " - Apple Reveals the New 2024 iMac: Familiar on the Outside, but With New Power Inside\n",
      " - iPad 10: Apple Would Never Do It, but Amazon Crushes the Tablet’s Price at Prime Day\n",
      " - Forget Black Friday, Amazon Slashes Prices on iPad Mini 6th Gen This Prime Day (30% Off)\n",
      " - Amazon Extends Prime Day, MacBook Air M2 Hits All-Time Low Price This Saturday\n",
      " - Amazon Unveils Major Price Cuts on The Latest MacBook Pro: Apple Hates Discounts but Can’t Do Anything About It\n",
      " - For The First Day of Prime Day, Amazon Destroys the Price of Apple AirTags to a Record Low\n",
      " - Prime Day: AirTags Fly Off Amazon’s Shelves, Priced Lower Than Your Favorite Pizza\n",
      " - Amazon Didn’t Sell Out of AirPods Pro 2 During Prime Day; Huge Promotion This Weekend\n",
      " - Prime Day: Amazon Cuts Prices Deep, 10 Best Deals of Tuesday Morning \n",
      " - Prime Day Isn’t Over Yet; Amazon Reveals 10 Amazing Deals This Saturday Morning\n",
      " - Forget Black Friday: Here Are 10 Amazon Deals Still Going Strong This Post-Prime Day Monday\n",
      " - These Prime Day Apple Deals Won't Last Forever: Get Them While You Can\n",
      " - One Week After Prime Day, Here Are the 10 Best Deals Still Available on Amazon (Up to 80% Off)\n",
      " - This Bracelet Allows You to ‘Touch’ a Loved One, No Matter Where You Are\n",
      " - Apple Discontinued These Four Products This Year, But One Will Return\n",
      " - Amazon Still Offers iPad 9 at Prime Day Price to Combat Prime Day FOMO\n",
      " - Amazon’s Fourth Price Drop on AirPods Pro 2 in Three Days, This Prime Day is Insane\n",
      " - Prime Day: Amazon Slashes Prices, Here Are the 10 Best Deals of Monday Morning\n",
      " - Prime Day: Amazon is Not Done Yet, Here Are the 10 Best Deals for This Thursday\n",
      " - I review smartwatches across every brand — these are the 5 Prime Day deals I'd personally buy\n",
      " - Prime Day: Amazon Reveals Exciting New Deals, Here Are Our Top 12 Picks for Wednesday\n",
      " - Apple may have just killed this 16-year old Mac product\n",
      " - Amazon Kicks Off Pre-Prime Day with LG OLED TVs at Prices So Low They Can’t Be Shown Publicly (40% Off)\n",
      " - Prime Day: Here Are 17 Offers Up to 80% Off for This Sunday on Amazon\n",
      " - Nvidia's value soars by $400 billion in 5 days. That's more than Costco is worth.\n",
      " - Microsoft Discontinuing Mixed Reality HoloLens 2 Headset\n",
      " - Lowest price anywhere: M3 MacBook Air with 16GB RAM, 512GB SSD drops to $1,249\n",
      " - Amazon is becoming Big Tech's king of cash, and Wall Street wants a piece of it\n",
      " - All the Prime Day Deals to Grab ASAP, Including Le Creuset, KitchenAid, and Apple\n",
      " - Boeing's turnaround plan is something any business can relate to: focus on the culture and the work\n",
      " - 26 Best Prime Day Deals Under $30\n",
      " - Best Buy takes on Amazon Prime Day with its 48-hour flash sale on Macs\n",
      " - Pick up Apple's M3 13-inch MacBook Air with 16GB RAM, 512GB storage for $1,349\n",
      " - 6 awesome Android 15 features Apple needs to steal for iOS 19\n",
      " - Klarna, the buy-now, pay-later firm, is looking to make a Robinhood-like product for trading stocks, an internal job ad shows\n",
      " - Kevin Kline says the secret to his 35-year marriage to Phoebe Cates is not having a 'Hollywood marriage'\n",
      " - The Best October Prime Day Deals That Are Actually Worth Your Money\n",
      " - Apple's holiday quarter will again see giant challenges because of supply chain issues\n",
      " - Apple Intelligence is here, and these are the features it’s still missing\n",
      " - Steep price drop drives Apple's upgraded 14-inch MacBook Pro M3 down to $1,499\n",
      "\n",
      "Topic 3:\n",
      " - Tim Cook is having a great week as Apple stock hovers within reach of record high\n",
      " - Warren Buffett Sells Over Half of Berkshire's Apple Stake\n",
      " - $2 trillion Norway oil fund CEO Nicolai Tangen says AI stock boom has created a concentration risk ‘we have never seen before’\n",
      " - Tim Cook sells Apple stock worth in excess of $50 million\n",
      " - Tim Cook sells $50M worth of AAPL shares, but the timing is coincidental\n",
      " - Nvidia CEO Jensen Huang breaks down how he interviews job candidates\n",
      " - Apple CEO Tim Cook Sells Over $50 Million Worth of Stock\n",
      " - Apple's 16-Year-Old SuperDrive Now Out of Stock Worldwide, Likely Discontinued\n",
      " - Nvidia's stock surge sent its market cap past Microsoft's and close to a record high\n",
      " - Stock market today: Chinese shares soar, then fade as Beijing outlines details of stimulus\n",
      "\n",
      "Topic 4:\n",
      " - Amazon is clearing out stock with record-low prices on Apple AirTags, matching last year’s Black Friday deal\n",
      " - Apple Clears Out AirTag Stock for Prime Day: Here’s One of the Best Price Ever Seen\n",
      " - Amazon is clearing out stock with record-low prices on AirTags, matching last year’s Black Friday deal\n",
      " - Grab the AirPods Pro 2 for the Same Price as AirPods 4—Amazon’s Stock Won’t Last Long\n",
      " - Amazon is Offering The Beats Solo 4 For Under $100, Looking to Clear Its Stock Before The Weekend Ends\n",
      " - Jim Cramer Says Apple (AAPL) Stock Will ‘Blow Through a Lot of Levels’\n",
      " - Apple stock tumbles after analyst says iPhone 16 orders cut by 10 million units, sees 'no evidence' AI boosting demand\n",
      " - Should You Buy Apple Stock Before Oct. 28?\n",
      " - An incoming 'M&A supercycle' wouldn't just be a win for dealmakers\n",
      " - Apple cuts iPhone 16 orders at key supplier, Barclays claims\n",
      " - Prediction: 1 Unstoppable Stock Will Join Nvidia, Apple, Microsoft, Amazon, Alphabet, and Meta in the $1 Trillion Club In 2025\n",
      " - M4 iMac shows Apple’s commitment to the all-in-one after some missed turns\n",
      " - Bulk buyers are paying above retail for the iPhone 16, for four reasons\n",
      " - The iPad we won’t travel without is $150 off during Prime Big Deal Days\n",
      " - India factory fire may force Apple iPhone orders back to China\n",
      " - Display shipments for M4 MacBook Air and new iPhone SE set to begin soon as early 2025 launches near\n",
      " - Apple stock slips after a big cut for iPhone 16 orders\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/usr/local/lib/python3.10/dist-packages/sklearn/feature_extraction/text.py:521: UserWarning: The parameter 'token_pattern' will not be used since 'tokenizer' is not None'\n",
      "  warnings.warn(\n"
     ]
    }
   ],
   "source": [
    "from newsapi import NewsApiClient\n",
    "from sklearn.feature_extraction.text import TfidfVectorizer\n",
    "from sklearn.cluster import KMeans\n",
    "from sklearn.metrics import silhouette_score\n",
    "from datetime import datetime, timedelta\n",
    "import pandas as pd\n",
    "\n",
    "class FinBERTSentimentAnalyzer:\n",
    "    def __init__(self, api_key):\n",
    "        # Initialize News API client\n",
    "        self.newsapi = NewsApiClient(api_key=api_key)\n",
    "\n",
    "    def fetch_news(self, phrase='Apple stock', days_back=30):\n",
    "        # Get news articles from the last `days_back` days\n",
    "        date_from = (datetime.now() - timedelta(days=days_back)).strftime('%Y-%m-%d')\n",
    "        articles = self.newsapi.get_everything(\n",
    "            q=phrase,\n",
    "            from_param=date_from,\n",
    "            language=\"en\",\n",
    "            sort_by=\"relevancy\",\n",
    "            page_size=100\n",
    "        )\n",
    "        titles = [article['title'] for article in articles['articles']]\n",
    "        return pd.DataFrame(titles, columns=[\"Title\"])\n",
    "\n",
    "    def custom_tokenizer(self, text):\n",
    "        # Keywords for increasing TF-IDF weight\n",
    "        financial_keywords = [\"stock\", \"shares\", \"record\", \"revenue\", \"CEO\", \"stake\", \"sell\", \"buy\", \"market\", \"growth\"]\n",
    "        deal_keywords = [\"deal\", \"discount\", \"Prime Day\", \"sale\", \"price\", \"clearance\", \"promotion\"]\n",
    "\n",
    "        # Tokenization with keyword weighting\n",
    "        tokens = text.lower().split()\n",
    "        custom_tokens = []\n",
    "        for token in tokens:\n",
    "            if token in financial_keywords:\n",
    "                custom_tokens.extend([token] * 3)  # Boost weight for financial keywords\n",
    "            elif token in deal_keywords:\n",
    "                custom_tokens.extend([token] * 2)  # Boost weight for deal keywords\n",
    "            else:\n",
    "                custom_tokens.append(token)\n",
    "        return custom_tokens\n",
    "\n",
    "    def perform_clustering(self, titles_df, num_clusters=5):\n",
    "        # Vectorize with TF-IDF, using custom tokenizer for weighted keywords\n",
    "        vectorizer = TfidfVectorizer(tokenizer=self.custom_tokenizer)\n",
    "        X = vectorizer.fit_transform(titles_df[\"Title\"])\n",
    "\n",
    "        # Apply K-means clustering\n",
    "        kmeans = KMeans(n_clusters=num_clusters, random_state=42)\n",
    "        labels = kmeans.fit_predict(X)\n",
    "\n",
    "        # Calculate silhouette score\n",
    "        sil_score = silhouette_score(X, labels)\n",
    "        print(\"Silhouette Score for K-means clustering:\", sil_score)\n",
    "\n",
    "        # Add clustering results to DataFrame\n",
    "        titles_df['Topic'] = labels\n",
    "        return titles_df, sil_score\n",
    "\n",
    "    def display_topics(self, titles_df, num_clusters):\n",
    "        for topic in range(num_clusters):\n",
    "            print(f\"\\nTopic {topic}:\")\n",
    "            topic_titles = titles_df[titles_df['Topic'] == topic]['Title'].tolist()\n",
    "            for title in topic_titles:\n",
    "                print(f\" - {title}\")\n",
    "\n",
    "\n",
    "api_key = \"API_KEY\"\n",
    "analyzer = FinBERTSentimentAnalyzer(api_key)\n",
    "\n",
    "news_df = analyzer.fetch_news(phrase='Apple stock', days_back=30)\n",
    "\n",
    "num_clusters = 5\n",
    "clustered_df, silhouette_score = analyzer.perform_clustering(news_df, num_clusters=num_clusters)\n",
    "\n",
    "analyzer.display_topics(clustered_df, num_clusters)\n"
   ]
  }
 ],
 "metadata": {
  "colab": {
   "provenance": []
  },
  "kernelspec": {
   "display_name": "Python 3",
   "name": "python3"
  },
  "language_info": {
   "name": "python",
   "version": "3.11.4"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 0
}
